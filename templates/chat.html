<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>CheppIRC</title>
  <style>
    body {
      padding: 0;
      margin: 0;
    }
    content {
      width: 80%;
      float: left;
      background-color: #FFFFFF;
    }
    .content-top {
      width: 100%;
      min-height: 50px;
      background-color: #3F51B5;
      color: #FFFFFF;
    }
    aside {
      width: 20%;
      float: left;
    }
    .side-top {
      width: 100%;
      height: 50px;
      background-color: #303F9F;
      text-align: center;
      vertical-align: middle;
    }
    .logo {
      float: left;
      width: auto;
      margin: 15px;
    }
    .chepp {
      font-style: italic;
    }
    .channel-tabs {
      float: left;
      width: auto;
    }
    .channel-boxes {
      clear: both;
    }
    .channel-tab {
      display: inline-block;
      padding: 10px;
      margin: 0 5px;
      background-color: #303F9F;
    }
    .sender {
      min-width: 100px;
      color: #FF9800;
    }
  </style>
  <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
</head>
<body>

<header>
</header>

<content>
  <span id="session" data-id="{{.Uuid}}"/>
  <div class="content-top">
    <div class="logo">
      <span class="chepp">Chepp</span><span class="irc">IRC</span>
    </div>

    <div class="channel-tabs">
      {{range $target, $messages := .Messages}}
      <div class="channel-tab {{$target}}-channel"> {{$target}}</div>
      {{end}}
    </div>
  </div>

  <div class="channel-boxes">
    {{range $target, $messages := .Messages}}
    <div class="channel-box {{$target}}-channel">
      {{range $messages}}
      <div class="message">
        {{if .Sender}}
        <span class="sender">{{.Sender}}</span>
        {{end}}
        <span class="text">{{.Text}}</span>
      </div>
      {{end}}
    </div>
    {{end}}
  </div>
</content>

<aside>
  <div class="side-top">Users</div>
  {{range $target, $users := .Users}}
  <div class="user-box {{$target}}-channel">
    {{range $users}}
    <div class="user">{{.nick}}</div>
    {{end}}
  </div>
  {{end}}
</aside>
  <script type="text/javascript">
    function wsurl(s) {
      var l = window.location;
      return ((l.protocol === "https:") ? "wss://" : "ws://") + l.hostname + (((l.port != 80) && (l.port != 443)) ? ":" + l.port : "") + s;
      }
    console.log("url=", wsurl("ws/?session=test"))
    var serversocket = new WebSocket(wsurl("/ws?session=" + $("#session").attr("data-id")));
    serversocket.onmessage = function(e) {
                console.log(e.data);
        };
  </script>

</body>
</html>
